# Retrospective — Epic 7 : Gestion Talents & Manager

**Date :** 2026-02-19
**Facilité par :** Bob (Scrum Master)
**Projet :** BookMi_v2 — Marketplace de réservation de talents en Côte d'Ivoire
**Stack :** Laravel 12 backend + Flutter 3 mobile
**Epic :** 7 — Gestion Talents & Manager

---

## Metriques finales

| Indicateur              | Valeur          |
|-------------------------|-----------------|
| Stories planifiees      | 10              |
| Stories terminees       | 10              |
| Taux de completion      | 100 %           |
| Backend (Laravel)       | 9 stories        |
| Flutter                 | 1 story (7-10)  |
| Commandes schedulees    | 2 (02:00 / 09:00)|
| Migrations crees        | 4               |
| Fichiers de tests       | 6+              |
| Statut epic             | DONE            |

---

## Recapitulatif des stories

| Story | Titre                                    | Statut |
|-------|------------------------------------------|--------|
| 7-1   | Assignation manager a un talent          | done   |
| 7-2   | Interface unifiee manager multi-talents  | done   |
| 7-3   | Alertes surcharge talent                 | done   |
| 7-4   | Gestion calendrier par le manager        | done   |
| 7-5   | Validation reservation par le manager   | done   |
| 7-6   | Messages manager au nom du talent        | done   |
| 7-7   | Niveaux automatiques talent (gamification)| done  |
| 7-8   | Analytics talent                         | done   |
| 7-9   | Attestation de revenus annuelle          | done   |
| 7-10  | Onboarding gamifie talent Flutter        | done   |

---

## Ce qui a bien fonctionne — "Keep"

---

**Bob (Scrum Master):** Commençons par les victoires. Epuise d'epics en epics, le projet BookMi prend de l'envergure. L'Epic 7 etait sans doute la plus complexe structurellement, avec un nouveau role (manager), des permissions croisees talent/manager, des commandes schedulees, de la gamification, un PDF et du Flutter. Toutes les 10 stories sont `done`. C'est une excellente performance d'equipe.

**Alice (Product Owner):** Ce que j'ai trouve remarquable, c'est la coherence de la vision produit maintenue tout au long de l'epic. Le manager n'est pas juste un "admin lite" : il a un perimetre precis. Il peut gerer le calendrier, valider les reservations, ecrire des messages au nom du talent — mais avec une tracabilite complete via `sent_by_manager_id`. Ça protege le talent et le client simultanement. C'est exactement ce que nous avions imagine.

**Charlie (Senior Dev):** Techniquement, j'ai beaucoup aime la decision de centraliser toute la logique manager dans un seul `ManagerService`. Plutot que de disperser les verifications d'autorisation dans plusieurs controllers, on a un point d'entree unique : `assignManager()`, `unassignManager()`, `getMyTalents()`, `getTalentStats()`, `acceptBooking()`, `rejectBooking()`, `createCalendarSlot()`, `sendMessageAsTalent()`... Un seul service bien teste, c'est maintenable. Et le middleware `EnsureUserIsManager` enregistre en alias `'manager'` dans `bootstrap/app.php` est une solution propre pour proteger tout le groupe de routes manager.

**Dana (QA Engineer):** La qualite des tests sur cette epic est au rendez-vous. On a couvert tous les cas d'erreur importants : 404 manager non trouve, 422 mauvais role, 422 deja assigne, 403 non assigne. Le `--dry-run` sur les commandes schedulees `bookmi:recalculate-talent-levels` et `bookmi:detect-talent-overload` nous a sauve la mise plusieurs fois pendant les verifications. Les 5 cas de test sur `RecalculateTalentLevelsTest` couvrent les 4 niveaux de maniere exhaustive.

**Elena (Junior Dev):** Pour moi, la grande fierte de cette epic c'est la story 7-10 : l'onboarding gamifie Flutter. C'est ma premiere contribution significative a la partie mobile et le resultat est visible et motivant pour l'utilisateur. Les 5 etoiles qui se remplissent d'orange, la `_CompletionBanner` avec sa double animation `FadeTransition` + `ScaleTransition` en spring elastique — c'est le genre de detail qui fait la difference UX. Et les 7 cas de test du `OnboardingCubit` couvrent tous les etats du sealed pattern correctement.

**Aboubakarouattara (Project Lead):** Ce qui me satisfait le plus, c'est le niveau de maturite produit que l'Epic 7 apporte a BookMi. Avec les niveaux automatiques (nouveau / confirme / populaire / elite) calcules chaque nuit a 02:00, l'attestation PDF de revenus annuels utilisable pour une banque ou les impots, et le dashboard analytics avec les 12 derniers mois de CA — on a un vrai produit professionnel, pas juste un MVP. Les talents ivoiriens auront entre les mains un outil digne de ce qu'ils meritent.

---

## Ce qui a ete difficile — "Problems"

---

**Bob (Scrum Master):** Soyons honnetes. L'Epic 7 n'a pas ete sans friction. Quels ont ete vos points de douleur ?

**Charlie (Senior Dev):** Le defi le plus constant, c'etaient les verifications d'autorisation en cascade. Pour chaque action manager, on devait verifier : (1) que l'utilisateur a bien le role `manager` via le middleware, (2) que ce manager est bien assigne au talent cible, et parfois (3) que l'objet concerne (slot de calendrier, reservation) appartient bien au talent. Si une seule de ces verifications manque, c'est une faille de securite. Maintenir cette logique dans toutes les methodes de `ManagerService` tout en restant DRY a demande beaucoup d'attention.

**Dana (QA Engineer):** J'ai eu du mal a tester la gestion de surcharge (story 7-3) parce que le garde `overload_notified_at` cree un etat persiste entre les tests. Il fallait s'assurer de reinitialiser ce champ dans les factories et les `setUp()` pour eviter des tests qui passent de maniere aleatoire selon l'ordre d'execution. C'est une subtilite que les commandes schedulees apportent : elles ont des effets de bord sur les donnees qui necessitent une hygiene de test plus rigoureuse.

**Elena (Junior Dev):** Sur la story 7-10 Flutter, le plus complique a ete de synchroniser l'etat optimiste avec le rechargement serveur dans `markStepCompleted`. On voulait une reactivite immediate (l'UI se met a jour instantanement), mais en cas d'echec reseau il fallait rollback proprement. Le pattern `optimistic update → reload from server` du Cubit est elegant mais requiert une bonne gestion de la sequentialite des etats via `BlocBuilder`.

**Alice (Product Owner):** Cote product, j'ai eu des arbitrages difficiles sur la story 7-6 (messages manager au nom du talent). La question etait : le client doit-il savoir que c'est le manager qui ecrit ? On aurait pu vouloir la transparence totale. Mais le modele choisi — `sender_id = talent.user_id` + `sent_by_manager_id` en metadata — preserve la coherence conversationnelle pour le client tout en gardant la tracabilite pour l'admin. C'etait un equilibre delicat.

**Charlie (Senior Dev):** La story 7-8 analytics avait un defi interessant : grouper les revenus par mois sans utiliser `DATE_FORMAT()` de MySQL pour rester portable avec SQLite (tests). La decision de faire le groupement au niveau PHP plutot que SQL est sage pour les tests, mais il faudra surveiller les performances quand le volume de reservations grossira. C'est de la dette technique acceptable a court terme.

---

## Lecons apprises

---

**Bob (Scrum Master):** Voici les lecons cles que l'on doit capitaliser.

### Lecon 1 — Un service par domaine metier complexe, pas par story

**Charlie (Senior Dev):** Toute la logique manager dans un `ManagerService` unique etait la bonne decision. Quand les stories 7-1 a 7-6 ont ete implementees sequentiellement, chaque nouvelle methode beneficiait du contexte des precedentes. Si on avait cree un service par story (ex: `AssignManagerService`, `CalendarManagerService`...), on aurait eu de la duplication et des verifications incoherentes. Lecon : identifier le domaine metier en amont et creer l'architecture du service avant de commencer les stories, meme si le service grossit au fil des stories.

### Lecon 2 — Les commandes schedulees ont besoin d'un mode --dry-run systematique

**Dana (QA Engineer):** Les deux commandes `bookmi:recalculate-talent-levels` et `bookmi:detect-talent-overload` implementent toutes les deux un flag `--dry-run` qui log les changements sans les persister. C'est devenu un standard de facto dans le projet et il faut en faire une regle explicite : toute commande qui modifie des donnees en masse DOIT avoir un mode `--dry-run`. C'est indispensable pour les deploiements, les verifications de production et les tests.

### Lecon 3 — La gamification necessite des seuils documentés et versionnables

**Alice (Product Owner):** Les seuils de niveaux talent (nouveau/confirme/populaire/elite) sont dans `config/bookmi.php`. C'est bien. Mais si on les modifie en production, tous les niveaux vont se recalculer la nuit suivante — sans traçabilite de qui a change quoi et pourquoi. Il faut creer une convention : tout changement de seuil de gamification doit etre accompagne d'un commentaire versionne dans le fichier de config et d'une entree de changelog.

### Lecon 4 — Les tests d'integration multi-roles demandent un setup factory soigne

**Dana (QA Engineer):** Sur cette epic on a introduit un troisieme role metier (`manager`) en plus de `client` et `talent`. Chaque test qui implique plusieurs roles (talent assigne a un manager, qui a des reservations, qui appartient a des conversations) necessite un setup factory soigneux. Lecon : investir du temps en debut d'epic sur les helpers de test (traits, factories speciales) pour les scenarios multi-roles plutot que de dupliquer le code de setup dans chaque fichier de test.

### Lecon 5 — La generation PDF en Laravel necessite un test de regression visuel

**Charlie (Senior Dev):** La story 7-9 genere un PDF via DomPDF avec un template Blade. Les tests de feature verifient le `Content-Type: application/pdf` et le statut 200, mais ils ne valident pas le contenu visuel du document. Si quelqu'un modifie le template Blade, les tests passent mais le PDF peut etre visuellement casse. Il faudrait ajouter une verification du contenu textuel (ex: que le nom du talent, les montants, le titre apparaissent bien dans le PDF genere).

---

## Dette technique identifiee

---

**Bob (Scrum Master):** Tour de table pour la dette technique. Ce que l'on sait qu'on devra revisiter.

| # | Dette                                           | Priorite | Categorie      | Responsable suggere |
|---|-------------------------------------------------|----------|----------------|---------------------|
| 1 | Groupement mensuel analytics en PHP (story 7-8) — migrer vers SQL agregation indexee a haute volumetrie | Moyenne  | Performance    | Charlie             |
| 2 | Absense de test visuel/textuel sur le PDF d'attestation (story 7-9) | Haute    | Qualite tests  | Dana                |
| 3 | Helpers factory multi-roles non centralises — duplication dans les fichiers de tests feature manager | Faible   | Maintenabilite | Elena               |
| 4 | Pas de notification in-app talent quand le manager prend une action en son nom (accept/reject/message) — tracabilite incomplete cote talent | Haute    | Produit        | Alice               |
| 5 | Changelog versionne des seuils de gamification manquant — risque de regression silencieuse | Moyenne  | Gouvernance    | Bob                 |
| 6 | Pas de limite max de managers par talent ni de talents par manager — potentiel abus role | Moyenne  | Securite       | Charlie             |

---

## Action items pour l'Epic 8

---

**Bob (Scrum Master):** Voici les actions concretes qui decoulent de cette retrospective et qui doivent etre integrees avant ou pendant l'Epic 8.

| # | Action                                                                           | Assignee  | Echeance    |
|---|----------------------------------------------------------------------------------|-----------|-------------|
| 1 | Creer un `ManagerTestTrait` ou helper factory centralise pour les tests multi-roles | Elena   | Debut Epic 8|
| 2 | Ajouter verification contenu textuel dans `RevenueCertificateTest`              | Dana      | Sprint 1    |
| 3 | Implementer notification in-app talent quand manager agit en son nom            | Charlie   | Backlog 8   |
| 4 | Documenter convention changelog pour les changements de seuils gamification     | Bob       | Immediate   |
| 5 | Evaluer une limite configurable (ex: max 20 talents par manager) dans `bookmi.php` | Charlie | Analyse     |

---

## Apercu Epic 8 — Administration & Gouvernance

---

**Alice (Product Owner):** L'Epic 8 est la plus dense du projet avec 13 stories. Elle est deja `done` dans le sprint-status mais voici ce qu'elle couvre : le dashboard admin temps reel (8-1), la gestion des litiges avec tracabilite complete (8-2), les avertissements formels et suspensions (8-3), la detection automatique de comportements suspects (8-5), la piste d'audit complete (8-10), les KPIs plateforme (8-12) et le monitoring avec les logs (8-13).

**Charlie (Senior Dev):** Ce sont les fonctionnalites les plus sensibles de la plateforme. La piste d'audit (8-10) et la detection de comportements suspects (8-5) imposent une discipline architecturale forte : immutabilite des logs, performance des requetes d'agregation, et securite des endpoints admin. Tout ce que nous avons appris sur les permissions et les roles dans l'Epic 7 sera directement reutilise.

**Bob (Scrum Master):** L'Epic 7 nous a donne la maturite pour aborder l'Epic 8 avec confiance. Les patterns etablis — middleware role, service centralise, commandes schedulees avec `--dry-run`, tests feature multi-roles — sont desormais des standards de l'equipe.

---

## Conclusion — Mode celebration

---

**Bob (Scrum Master):** 10 stories. 10 statuts `done`. Un nouveau role metier complet, une gamification fonctionnelle, des PDF professionnels, et une page Flutter animee qui motive les talents a completer leur profil. L'Epic 7 est une reussite collective.

**Alice (Product Owner):** BookMi n'est plus un projet — c'est un produit. Les talents ivoiriens vont avoir un outil qui respecte leur metier : un manager peut les representer, leurs niveaux progressent avec leur activite, et ils ont un document officiel pour leur banque. Ça, c'est du concret.

**Charlie (Senior Dev):** En termes d'architecture, c'est l'epic qui a le plus solidifie notre backend. Le `ManagerService`, le `ManagerException`, le middleware alias — tout est en place pour que l'Epic 8 puisse s'appuyer dessus sans repartir de zero.

**Dana (QA Engineer):** La couverture de tests reste notre meilleur filet de securite. On a tenu le cap malgre la complexite des scenarios multi-roles. Mention speciale au `--dry-run` qui continuera a nous sauver en production.

**Elena (Junior Dev):** Je retiens l'onboarding Flutter comme ma fierte de cet epic. Voir les etoiles se remplir et la banniere de celebration apparaitre — c'est exactement le genre d'experience qui donne envie aux talents de s'investir dans la plateforme.

**Aboubakarouattara (Project Lead):** Sept epics completees. Une plateforme qui prend vie. BookMi v2 avance avec rigueur et ambition. Felicitations a toute l'equipe.

---

*Retrospective generee le 2026-02-19 par Bob (Scrum Master) — BookMi_v2*
*Epics completes : 1, 2, 3, 4, 5, 6, 7 (+ Epic 8 done) — Project retrospective : done*
