# Retrospective Epic 1 — Profil Talent & Découverte

**Date:** 2026-02-19
**Facilitateur:** Bob (Scrum Master)
**Epic:** 1 — Profil Talent & Découverte
**Statut final:** 12/12 stories DONE
**Incidents production:** 0
**Tests backend finaux:** 168 tests / 611 assertions
**Tests Flutter finaux:** 175 tests / 0 failures

---

## Métriques de l'Epic 1

| Indicateur | Valeur |
|---|---|
| Stories planifiées | 12 |
| Stories complétées | 12 (100%) |
| Incidents production | 0 |
| Tests backend (fin Epic) | 168 / 611 assertions |
| Tests Flutter (fin Epic) | 175 |
| Code reviews adversariales | 12 (1 par story) |
| Findings code review | ~45 (tous traités) |
| Regressions | 0 |
| Qualité Pint PSR-12 | Vert sur toutes les stories |
| Qualité PHPStan level 5 | Vert sur toutes les stories |
| Flutter analyze | 0 erreur / 0 warning (fin Epic) |

---

## Ouverture — Bob anime la retrospective

**Bob (Scrum Master):** Bonjour à toute l'équipe ! C'est avec une immense fierté que je vous réunis aujourd'hui pour la rétrospective de l'Epic 1 "Profil Talent & Découverte". Douze stories. Douze stories DONE. Zéro incident en production. Ce n'est pas rien. Prenons le temps de regarder ensemble ce que nous avons construit, ce qui a fonctionné, ce qui nous a mis en difficulté, et surtout ce que nous emportons pour l'Epic 2. Je vais commencer par notre Product Owner pour le bilan global.

---

## Ce qui s'est bien passé

**Alice (Product Owner):** Je vais commencer par les chiffres qui parlent d'eux-mêmes. 100% des stories terminées, 0 incident, et une base technique qui tient la route. Mais au-delà des chiffres, ce qui m'a vraiment impressionnée c'est la cohérence du produit. L'annuaire des talents (1.5), les écrans de découverte Flutter (1.10), le profil public (1.7 et 1.11) — tout s'assemble de façon fluide. Le client ivoirien qui ouvre l'app verra exactement ce qu'on avait promis dans le PRD.

**Charlie (Senior Dev):** Ce qui a fonctionné du côté technique, c'est l'architecture. Le pattern Controller → Service → Repository que nous avons posé dès la story 1.1 — et qui a tenu sur les 11 stories suivantes sans jamais flancher. Le fait que chaque controller soit "stupide" et que toute la logique métier vive dans les Services, ça a rendu les tests trivials à écrire. En story 1.9 (Favoris), le FavoriteService était tellement bien encapsulé qu'on a géré les cas ALREADY_FAVORITED, FAVORITE_NOT_FOUND et TALENT_NOT_FOUND sans jamais toucher au controller. C'est exactement ce qu'on voulait.

**Dana (QA Engineer):** De mon côté QA, ce qui m'a vraiment satisfaite c'est la discipline du format JSON envelope. Chaque endpoint, sans exception, retourne `{ "data": {...} }` pour le succès et `{ "error": { "code": "...", ... } }` pour les erreurs. Ça a rendu les tests assertJsonPath extrêmement fiables. En story 1.5 (Annuaire), les 22 tests Feature du TalentController étaient tous verts au premier run après implémentation — c'est rare et c'est le signe d'une architecture bien pensée.

**Elena (Junior Dev):** Personnellement, ce qui m'a aidée c'est la section "Composants existants à réutiliser — NE PAS recréer" dans chaque story. Quand j'arrivais sur la story 1.9, j'avais une liste claire : BaseController, ApiResponseTrait, BookmiException, TalentResource. Pas besoin de deviner. Ça m'a évité de réinventer la roue et m'a permis de me concentrer sur la vraie valeur ajoutée de la story.

**Aboubakarouattara (Project Lead):** Ce que je retiens en tant que Project Lead c'est la philosophie "zéro régression". À chaque story, on vérifiait que les N tests existants continuaient à passer. En story 1.9 on avait 152 tests existants avant d'en ajouter 13 nouveaux. Cette rigueur a produit une base de code où j'ai confiance. La fondation est solide pour bâtir les Epics suivants.

**Charlie (Senior Dev):** J'ajouterais la gestion Docker. La décision prise en 1.1 de binder les ports MySQL et Redis sur 127.0.0.1 plutôt que sur 0.0.0.0 était le bon appel sécurité. Et le Dockerfile PHP 8.4 Debian (au lieu d'Alpine) a évité tous les problèmes TLS qu'on aurait eu avec les dépôts Alpine. Ces détails d'infrastructure font une vraie différence à long terme.

**Bob (Scrum Master):** Excellent bilan. J'entends cohérence architecturale, discipline de test, et sécurité dès le départ. C'est le socle qu'on voulait. Passons maintenant aux difficultés — et il y en a eu.

---

## Ce qui a été difficile

**Charlie (Senior Dev):** Je vais être honnête : la story 1.1 nous a donné du fil à retordre sur des détails qu'on n'avait pas anticipés. Le fait que Spatie Permission v7 requiert PHP 8.4 alors que l'architecture spécifiait PHP 8.2+ minimum — c'était une décision critique à trancher rapidement. On a choisi PHP 8.4 + Spatie v7, c'était le bon choix, mais ça aurait dû être documenté dans les contraintes dès le départ.

**Dana (QA Engineer):** En story 1.3, j'ai eu quelques sueurs froides avec les tests de validation. Le format JSON envelope BookMi n'utilise pas le format standard Laravel pour les erreurs de validation. Donc utiliser `assertJsonValidationErrors()` ne marchait pas — il fallait utiliser `assertJsonPath('error.code', 'VALIDATION_FAILED')`. Cette nuance a provoqué des échecs de tests confus au début, avant qu'on comprenne le pattern.

**Elena (Junior Dev):** La gestion des types PHPStan level 5 m'a causé des difficultés, surtout dans les API Resources. En story 1.3, le `when()` avec le subcategory_id — PHPStan ne résolvait pas les types correctement avec la vérification truthy. Il fallait explicitement écrire `$this->subcategory_id !== null` pour satisfaire l'analyse statique. Ce n'est pas intuitif pour quelqu'un qui découvre PHPStan.

**Charlie (Senior Dev):** En story 1.5 (Annuaire), on a eu un bug de données dans les tests de tri par `created_at DESC`. Les factories créées dans la même seconde avaient le même timestamp, donc l'ordre était non-déterministe. La solution `$this->travel(1)->minutes()` entre les créations était la bonne, mais il a fallu diagnostiquer pourquoi les tests échouaient de façon intermittente avant de trouver la cause.

**Alice (Product Owner):** D'un point de vue fonctionnel, la story 1.5 avait une ambiguité dans les Dev Notes sur la nullabilité de `cachet_amount`. Les notes disaient nullable, la base de données avait une contrainte NOT NULL. Ça a obligé à supprimer un test entier (test_cachet_filter_excludes_null_cachet) et à revérifier le repository. Ce type d'incohérence documentation ↔ implémentation réelle est coûteux.

**Dana (QA Engineer):** En story 1.9 (Favoris), le test "dispatches FavoriteToggled on tap" du widget Flutter échouait à cause d'un problème d'égalité sur les events BLoC. Les sealed classes Dart nécessitent une implémentation manuelle de `==` et `hashCode` pour que les comparaisons fonctionnent dans les tests. Ce n'est pas documenté de façon évidente dans la doc Flutter BLoC.

**Elena (Junior Dev):** Et en story 1.12 (CI/CD), la découverte que le dossier `.github/workflows/` de Flutter dans `bookmi_app/` n'était pas exécuté par GitHub dans un monorepo — c'était une surprise. Dans un monorepo, seul le `.github/` à la racine est reconnu par GitHub Actions. Cette décision architecturale méritait d'être prise plus tôt.

**Bob (Scrum Master):** Ces difficultés sont précieuses. Elles nous montrent exactement où investir dans l'amélioration du process. Je note : ambiguités de documentation, PHPStan subtilités, patterns de test à mieux documenter. Passons aux leçons formelles.

---

## Leçons Apprises

### Leçon 1 — La documentation des contraintes techniques doit précéder l'implémentation

**Charlie (Senior Dev):** En story 1.1, la contrainte "Spatie Permission v7 requiert PHP 8.4" était dans les "Alertes critiques" de la story, mais pas dans les contraintes globales du projet. Dans chaque story qui dépend d'une contrainte cross-epic (version PHP, version MySQL, monorepo vs multi-repo), la contrainte doit être listée explicitement dans les Dev Notes au moment de la création de la story, pas découverte lors de l'implémentation.

**Action concrète:** Ajouter une section "Contraintes héritées de l'architecture" en tête de chaque story, listant les décisions irréversibles déjà prises dans les stories précédentes.

### Leçon 2 — Le format JSON envelope BookMi nécessite un helper de test dédié

**Dana (QA Engineer):** À chaque story, on a répété le même pattern : `assertJsonPath('error.code', 'VALIDATION_FAILED')`, `assertJsonPath('data.type', 'talent_profile')`, etc. Ce code est dupliqué dans des dizaines de tests. En Epic 2, nous devons créer une classe `BookmiTestHelper` ou un trait `AssertsBookmiResponse` avec des méthodes comme `assertBookmiSuccess()`, `assertBookmiValidationError()`, `assertBookmiErrorCode()`. Cela réduira la duplication et rendra les tests plus lisibles.

**Action concrète:** Créer `tests/Support/AssertsBookmiResponse.php` (trait) au début de l'Epic 2, à utiliser dans tous les nouveaux tests.

### Leçon 3 — Les tests de tri sur données temporelles doivent isoler le temps

**Charlie (Senior Dev):** Le bug de story 1.5 (factories créées dans la même seconde) est un classique. La règle est simple : quand un test vérifie un tri par `created_at` ou `updated_at`, toujours utiliser `$this->travel()` entre les créations pour garantir des timestamps distincts. Cette règle doit être documentée dans les Testing Standards du projet.

**Action concrète:** Ajouter dans le fichier de standards de test du projet : "Tout test vérifiant un tri temporel DOIT isoler les créations dans le temps via `$this->travel(N)->seconds()`."

### Leçon 4 — Les BLoC events Flutter nécessitent une implémentation explicite de l'égalité

**Elena (Junior Dev):** En Dart, les classes ne sont pas comparées par valeur par défaut. Pour les events BLoC utilisés dans les tests (vérifier que le bon event a été dispatché), il faut implémenter `==` et `hashCode`, ou utiliser le package `equatable`. En story 1.9, on a corrigé ça après le fait. En Epic 2, tous les BLoC events et states doivent étendre `Equatable` dès leur création.

**Action concrète:** Template Flutter standard pour les BLoC events : toujours étendre `Equatable` et implémenter `List<Object?> get props`.

### Leçon 5 — La structure monorepo doit être décidée et documentée avant le premier workflow CI

**Bob (Scrum Master):** La story 1.12 a révélé qu'on avait des workflows Flutter au mauvais endroit depuis la story 1.2. Dans un monorepo, seul `.github/workflows/` à la racine est reconnu par GitHub. Cette décision architecturale (monorepo vs multi-repo, emplacement du `.github/`) doit figurer dans l'architecture dès le départ, pas être découverte en story 1.12. Pour les Epics futurs, toute décision d'infrastructure CI/CD doit être capturée dans `architecture.md` avant la première story qui la concerne.

**Action concrète:** Ajouter dans `architecture.md` une section "Structure CI/CD monorepo" documentant que `.github/workflows/` est à la racine et que les filtres `paths:` contrôlent les déclencheurs par projet.

---

## Dette Technique Identifiée

**Charlie (Senior Dev):** Voici la dette technique que nous laissons derrière nous — rien de critique, mais à traiter dans les prochains sprints.

| ID | Description | Source | Priorité | Impact |
|---|---|---|---|---|
| TECH-DEBT-1 | Dev Notes story 1.5 incorrectes sur nullabilité `cachet_amount` | Review finding LOW story 1.5 | Faible | Documentation trompeuse pour le prochain développeur |
| TECH-DEBT-2 | Tests `per_page` limites (0, -1, 51) non couverts dans TalentController | Review finding LOW story 1.5 | Faible | Edge cases non testés |
| TECH-DEBT-3 | Valeur par défaut `perPage=20` dupliquée dans TalentController ET SearchService | Review finding LOW story 1.5 | Faible | Deux sources de vérité pour le même paramètre |
| TECH-DEBT-4 | Workflows Flutter dans `bookmi_app/.github/` jamais exécutés par GitHub (dead code) | Finding LOW story 1.12 | Faible | Confusion potentielle pour les nouveaux contributeurs |
| TECH-DEBT-5 | Table pivot `user_favorites` ne suit pas la convention alphabétique `talent_profile_user` | Review finding LOW story 1.9 | Faible | Inconsistance naming — migration renaming possible |
| TECH-DEBT-6 | Annotations `@mixin` et `@property` incohérentes dans FavoriteResource | Review finding LOW story 1.9 | Faible | Code style — correctif simple |
| TECH-DEBT-7 | Pas de tests de validation limites `per_page` dans l'annuaire talents | Review finding LOW story 1.5 | Faible | Couverture incomplète |

**Dana (QA Engineer):** TECH-DEBT-3 mérite d'être traité dès le début de l'Epic 2, car on va ajouter de nouveaux endpoints paginés pour l'authentification. Autant centraliser la valeur par défaut maintenant.

**Alice (Product Owner):** Je priorise TECH-DEBT-3 et TECH-DEBT-1 pour les premiers tickets de l'Epic 2. Les autres peuvent attendre le sprint de maintenance.

---

## Evaluation de la Readiness pour l'Epic 2

**Bob (Scrum Master):** Évaluons maintenant notre readiness pour l'Epic 2 "Authentification". L'Epic 2 porte sur l'inscription client/talent, la vérification OTP téléphone, la connexion email/mot de passe, la réinitialisation de mot de passe, la déconnexion et la gestion des tokens.

**Charlie (Senior Dev):** Côté backend, les dépendances critiques de l'Epic 2 sont :

- **Laravel Sanctum** : installé depuis story 1.3, le middleware `auth:sanctum` est opérationnel
- **Spatie Permission** : NON installé — c'est le premier package à installer en Epic 2 story 2.1
- **Structure routes API** : routes `/api/v1/` versionnées opérationnelles avec groupes auth:sanctum en place
- **BookmiException** : pattern d'erreur métier bien établi avec codes préfixés `AUTH_`
- **AppServiceProvider** : bindings Repository déjà structurés — prêt pour `AuthRepository`
- **Exception handler global** : gère déjà `AuthenticationException` → 401 JSON envelope

**Elena (Junior Dev):** Côté Flutter, les dépendances sont :

- **ApiClient** : opérationnel avec interceptors auth (stub), retry, logging, SentryDio
- **GoRouter** : configuré avec guards et routes nommées — prêt pour les redirections auth
- **Architecture BLoC** : patterns établis en stories 1.9/1.10/1.11 — l'AuthBloc suivra les mêmes conventions
- **Hive** : configuré depuis story 1.2/1.9 — prêt pour stocker les tokens auth localement

**Alice (Product Owner):** Les stories 2.1 à 2.6 sont déjà rédigées et prêtes pour le développement. Les dépendances métier clés :

- La table `users` existe déjà avec les champs de base
- La migration des champs auth (`phone`, `phone_verified_at`, `otp_*`, `password_reset_token`) est dans la story 2.1
- Le `UserRole` enum est nécessaire en story 2.1 — les rôles `client` et `talent` conditionnent toutes les autorisations futures

**Dana (QA Engineer):** Point d'attention QA pour l'Epic 2 : les tests SMS/OTP vont nécessiter un mock du `SmsService`. Il faudra soit un fake SMS provider pour les tests (recommandé), soit des patterns d'injection de dépendance mockables dès la conception du service. À discuter en Sprint Planning Epic 2.

**Bob (Scrum Master):** Verdict readiness : GO pour l'Epic 2. Aucun bloqueur technique. Les dépendances sont en place. La seule action préalable est l'installation de Spatie Permission v7 — premier task de la story 2.1.

---

## Action Items

| # | Action | Owner | Priorité | Sprint |
|---|---|---|---|---|
| AI-1 | Créer le trait `AssertsBookmiResponse` dans `tests/Support/` pour standardiser les assertions JSON envelope dans tous les tests | Dana (QA Engineer) | HAUTE | Début Epic 2, avant première story |
| AI-2 | Corriger la duplication `perPage=20` dans TalentController et SearchService — une seule source de vérité dans `config/bookmi.php` | Charlie (Senior Dev) | HAUTE | Sprint 1 Epic 2 |
| AI-3 | Documenter dans `architecture.md` la règle "tests de tri temporel → utiliser `$this->travel()`" dans la section Testing Standards | Elena (Junior Dev) | MOYENNE | Sprint 1 Epic 2 |
| AI-4 | Documenter dans `architecture.md` la règle "BLoC events/states Flutter → étendre Equatable" dans la section Flutter Patterns | Elena (Junior Dev) | MOYENNE | Sprint 1 Epic 2 |
| AI-5 | Corriger les Dev Notes story 1.5 (nullabilité `cachet_amount`) pour éviter de tromper le prochain développeur qui reprend le code | Aboubakarouattara (Project Lead) | FAIBLE | Backlog maintenance |

**Bob (Scrum Master):** Cinq actions items, toutes assignées, toutes priorisées. AI-1 et AI-2 sont critiques avant de commencer l'Epic 2. Les autres peuvent être traités en parallèle du développement.

---

## Apercu Epic 2 — Authentification

**Alice (Product Owner):** L'Epic 2 "Authentification" couvre 6 stories :

- **2.1** : Inscription client et talent (création compte, rôles, Spatie Permission)
- **2.2** : Vérification OTP téléphone (envoi SMS, validation code, `phone_verified_at`)
- **2.3** : Connexion email / mot de passe (login Sanctum, token personal access)
- **2.4** : Réinitialisation mot de passe (email reset, token expiry)
- **2.5** : Déconnexion et gestion token (logout, révocation tokens, refresh)
- **2.6** : Écrans authentification Flutter (register, login, OTP, reset screens)

**Charlie (Senior Dev):** Les dépendances techniques critiques à préparer :

- Story 2.1 installe `spatie/laravel-permission` v7 → PHP 8.4 déjà en place, pas de blocage
- Story 2.1 crée l'`AuthController` qui sera réutilisé dans toutes les stories 2.x
- Story 2.2 crée le `SmsService` — nécessite un provider SMS ivoirien (Orange CI / MTN CI / Twilio). Le choix du provider doit être confirmé par Alice avant le Sprint Planning
- Story 2.3 implémente le token Sanctum — l'`AuthInterceptor` Flutter (actuellement stub) sera activé en story 2.6
- Story 2.5 (gestion tokens) est critique pour la sécurité — le token doit être révocable côté serveur

**Elena (Junior Dev):** Côté Flutter, story 2.6 est la plus impactante pour l'architecture mobile. Elle va :
- Activer l'`AuthGuard` dans GoRouter (actuellement désactivé)
- Connecter le `AuthBloc` aux endpoints réels
- Implémenter la persistance du token dans Hive
- Déclencher la navigation automatique vers le home après connexion réussie

**Dana (QA Engineer):** Pour la QA de l'Epic 2, je vais préparer un plan de test spécifique pour les scénarios OTP : code expiré, code invalide, trop de tentatives, renvoi OTP. Ces edge cases sont critiques pour la sécurité et doivent être couverts dès la story 2.2.

**Alice (Product Owner):** Un point product important : en Côte d'Ivoire, le numéro de téléphone est l'identifiant principal. L'inscription par email est secondaire. L'UX doit prioriser le flow téléphone → OTP → profil. Stories 2.1 et 2.2 doivent être développées en séquence stricte, pas en parallèle.

**Bob (Scrum Master):** Noté. Sprint Planning Epic 2 donc : 2.1 en premier, 2.2 en dépendance stricte de 2.1, puis 2.3/2.4/2.5 peuvent se développer en parallèle si la capacité le permet, 2.6 Flutter en dernier pour intégrer tous les flows backend.

---

## Conclusion — Mode Celebration

**Bob (Scrum Master):** Et maintenant, le moment que j'attendais depuis le début de cette retrospective. Il est temps de célébrer !

Il y a quelques semaines, nous avions une feuille blanche et une ambition : construire la marketplace de référence pour les talents en Côte d'Ivoire. Aujourd'hui, nous avons :

- Un backend Laravel 12 avec PHP 8.4, MySQL 8.4, Redis 7.4, Nginx, Docker — tout est en production-ready
- 12 catégories de talents seedées, de DJ à Magicien en passant par Traiteur et Maquilleur
- Un annuaire avec filtres, géolocalisation, pagination cursor-based
- Des profils talent complets avec packages de prestation
- Un système de favoris backend + mobile avec cache Hive offline
- Des écrans Flutter qui ressemblent à une vraie app
- Un pipeline CI/CD GitHub Actions qui surveille tout ça
- 168 tests backend / 175 tests Flutter — et ZÉRO régression depuis le jour 1

Ça s'appelle une Epic réussie.

**Alice (Product Owner):** Je veux juste ajouter que ce qu'on a construit n'est pas juste du code. C'est la vision de DJ Kerozen à Abidjan qui peut être découvert par un client qui organise un mariage. C'est le photographe événementiel de Yamoussoukro qui a un profil professionnel. C'est l'infrastructure qui va permettre à des centaines de talents ivoiriens de vivre de leur art. Merci à toute l'équipe.

**Charlie (Senior Dev):** D'un point de vue technique, je suis vraiment fier de l'architecture. On a tenu la ligne PSR-12, PHPStan level 5, pattern Service/Repository — sans jamais déroger. Quand on écrira l'Epic 3 dans six mois, on pourra relire le code de l'Epic 1 sans honte. C'est rare et ça mérite d'être salué.

**Dana (QA Engineer):** 0 incidents. 0 regressions. 100% de coverage sur les acceptance criteria. En tant que QA, c'est le score parfait. On repart avec des patterns de test solides et un framework d'assertion qu'on va encore améliorer en Epic 2.

**Elena (Junior Dev):** Pour ma part, j'ai appris énormément — Laravel Repository pattern, BLoC Flutter, Hive cache, PHPStan, Sentry monitoring. Chaque story était un cours condensé. C'est la meilleure façon d'apprendre : en livrant de la vraie valeur, pas juste des exercices théoriques.

**Aboubakarouattara (Project Lead):** Merci à toute l'équipe. Merci Bob pour ton animation. On a posé les fondations de BookMi. Maintenant on construit les murs — l'authentification, puis les réservations, puis les paiements. L'Epic 1 a prouvé qu'on sait travailler ensemble, livrer vite, et livrer bien. L'Epic 2 va montrer qu'on peut faire confiance à cette fondation pour construire encore plus haut. Allez, on repart !

**Bob (Scrum Master):** C'est dit ! Epic 2 — on est prêts. Sprint Planning dans 48 heures. D'ici là, profitez bien de cette victoire. Vous l'avez méritée.

---

## Annexe — Récapitulatif des Stories Epic 1

| Story | Titre | Status | Tests ajoutés | Findings review |
|---|---|---|---|---|
| 1.1 | Initialisation projet backend Laravel | done | 12 (43 assertions) | 6 (4 MEDIUM, 2 LOW) — tous corrigés |
| 1.2 | Initialisation projet mobile Flutter | done | — | — |
| 1.3 | Modèle Talent et CRUD Profil | done | 38 (161 assertions) | 10 (4 HIGH, 4 MEDIUM, 2 LOW) — 8 corrigés |
| 1.4 | Vérification d'identité | done | — | — |
| 1.5 | Annuaire des talents avec filtres | done | 28 (94 tests total) | 6 (3 MEDIUM, 3 LOW) — 3 corrigés |
| 1.6 | Recherche par géolocalisation | done | — | — |
| 1.7 | Profil public talent | done | — | — |
| 1.8 | Packages de prestation | done | — | — |
| 1.9 | Favoris | done | +13 backend / +15 Flutter | 8 (2 HIGH, 4 MEDIUM, 2 LOW) — 6 corrigés |
| 1.10 | Écrans découverte Flutter | done | — | — |
| 1.11 | Écran profil talent Flutter | done | — | — |
| 1.12 | Pipeline CI/CD initiale | done | +3 Sentry | 5 (1 MEDIUM, 3 LOW, 1 DOC) — tous corrigés |

---

*Document généré le 2026-02-19 par Bob (Scrum Master) — Projet BookMi_v2*
*Retrospective Epic 1 "Profil Talent & Découverte" — 12/12 stories DONE*
